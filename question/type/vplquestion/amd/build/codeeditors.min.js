define(["jquery","core/url"],function(a,b){var c;function d(b,d,e){var f,g,h=null;return void 0===e&&(e="plain_text"),b.each(function(){var b=a(this),i=a("<div>",{width:"100%",height:d,id:"ace_placeholder_"+b.attr("name"),class:"ace-placeholder"}).insertAfter(b);b.hide(),a("<div>",{id:"ace_resize_"+b.attr("name"),class:"ace-resize"}).insertAfter(i).mousedown(function(a){g=a.clientY,h=i,a.preventDefault()}),(f=ace.edit(i[0])).setOptions({theme:"ace/theme/"+c,mode:"ace/mode/"+e}),f.$blockScrolling=1/0,f.getSession().setValue(b.val()),f.setReadOnly(b.is("[readonly]")),a("input[type=submit], .qvpl-buttons button").click(function(){b.val(ace.edit("ace_placeholder_"+b.attr("name")).getValue())})}),a(window).mousemove(function(a){h&&(h.height(function(b,c){return c+a.clientY-g}),g=a.clientY,ace.edit(h[0]).resize(),a.preventDefault())}).mouseup(function(){h=null}),f}function e(){if("undefined"!=typeof ace)return a.Deferred().resolve();var c=b.relativeUrl("/mod/vpl/editor/ace9");return a.ajax({url:c+"/ace.js",dataType:"script",cache:!0,success:function(){ace.config.set("basePath",c)}})}return{setupFormEditors:function(b,f){c=b,e().done(function(){d(a(".code-editor textarea"),"170px"),f()})},setupQuestionEditor:function(b,f,g,h,i){c=b,e().done(function(){var b=d(f,"200px",f.data("templatelang"));b.setOption("firstLineNumber",h),g.each(function(){var c=a(this).data("text");a(this).removeAttr("data-text"),a(this).click(function(a){b.getValue()!=c&&b.setValue(c),a.preventDefault()})}),i()})}}});