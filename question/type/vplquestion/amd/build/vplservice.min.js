define(["jquery","core/url"],function(a,b){function c(a,c,d){return void 0===d&&(d="edit"),b.relativeUrl("/mod/vpl/forms")+"/"+d+".json.php?id="+a+"&userId="+c+"&action="}var d={},e={reqfile:[],execfiles:[]};return d.info=function(a,b){return void 0!=e[a][b]?Promise.resolve(e[a][b]):("reqfile"==a?VPLUtil.requestAction("resetfiles","",{},c(b,"")):VPLUtil.requestAction("load","",{},c(b,"","executionfiles"))).promise().then(function(c){var d="reqfile"==a?c.files[0]:c.files;return e[a][b]=d,d})},d.save=function(c,d,e,f){return a.ajax(b.relativeUrl("/question/type/vplquestion/ajax/savetovpl.json.php"),{data:{id:c,qid:d,answer:e,filestype:f},method:"POST"}).promise()},d.exec=function(a,b,d,e,f){var g={ajaxurl:c(b,d),resultSet:!1,setResult:function(a){this.resultSet=!0,f(a)},close:function(){var a=this;setTimeout(function(){a.resultSet||f({execerror:M.util.get_string("execerrordetails","qtype_vplquestion")})},600)},getConsole:function(){return e},run:function(a,b,c){e.connect(b.executionURL,function(){c.close()})}};return VPLUtil.requestAction(a,"",{},g.ajaxurl).done(function(a){VPLUtil.webSocketMonitor(a,"","",g)})},{call:function(a,...b){return VPLUtil.progressBar=function(){this.setLabel=function(){},this.close=function(){},this.isClosed=function(){return!0}},d[a](...b)},langOfFile:function(a){return VPLUtil.langType(a.split(".").pop())}}});